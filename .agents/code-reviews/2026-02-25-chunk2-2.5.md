# Code Review: Chunk 2 + 2.5 — Calendar Fixes + Staff View UX

**Date**: 2026-02-25
**Reviewer**: Claude (automated)
**Status**: PASS — no issues found

## Files Reviewed

| File | Changes | Verdict |
|------|---------|---------|
| `src/app/(dashboard)/calendar/day/[date]/page.tsx` | Add Event button, meeting-first sort, swap card order, conditional headings | Clean |
| `src/app/(dashboard)/calendar/new/page.tsx` | Read `?date=` param, pre-fill form via `initialData` | Clean |
| `src/app/(dashboard)/calendar/page.tsx` | Removed `isHR` gate — Add Event visible to all | Clean |
| `src/components/layout/sidebar.tsx` | Added "My Profile" nav, `adminOnly` on Employees | Clean |
| `src/components/layout/header.tsx` | Added `/profile` to `pageNames` | Clean |
| `src/middleware.ts` | Removed `/calendar/new` from HR routes, added `/employees` | Clean |

## Analysis

### Security
- Middleware correctly blocks staff from `/employees` (and all sub-routes like `/employees/[id]`, `/employees/new`)
- `hrAllowedRoles` includes ADMIN, HR, MANAGER — consistent with RBAC hierarchy
- Calendar API already allows all authenticated users — UI was the only restriction

### Correctness
- `viewAs` conditional correctly uses the existing variable (line 110)
- Card order swap is a pure JSX reorder — no logic changes needed
- `searchParams` uses Next.js 15-style async pattern (already established in the file)
- Date validation regex `^\d{4}-\d{2}-\d{2}$` prevents injection in query param

### Patterns
- `adminOnly: true as const` matches existing Settings pattern exactly
- `User` icon import from lucide-react is consistent (already used in header.tsx)
- No new dependencies added

### Known Pre-existing Issues (not in scope)
- Sidebar `isAdmin` uses `ADMIN || HR` (no MANAGER) — documented inconsistency
- `isOwner` check in CalendarEventCard is permissive — documented, separate fix

## Findings
None — all changes are minimal, targeted, and follow established patterns.
