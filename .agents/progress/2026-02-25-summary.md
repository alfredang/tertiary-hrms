# Summary: 25 Feb 2026

**Status**: All executed, committed on `dev`, deployed 26 Feb via merge to `main`

## Commits on Dev

| Commit | Feature |
|--------|---------|
| `23f0b34` | Staff view UX |
| `d72d9ec` | Mobile UI polish |
| `7631cbc` | Mobile UX + cleanup script |
| `edf598c` | Leave proration fix + rollover system |
| `0111176` | Half-day leave (AM/PM) |
| `c6c1d43` | Calendar privacy + balance fixes (committed 26 Feb) |

## Plans Executed

### Staff View UX (Chunk 2 + 2.5)
- Removed middleware block on `/calendar/new` so all users can add events.
- Added "Add Event" button on day detail page with date pre-fill.
- "My Profile" sidebar nav for all roles, hid Employees from staff view.
- Sorted meetings first in day detail, fixed calendar grid row border overflow.

### Mobile UI Polish (Chunk 3)
- Tailwind-only pass across 16 files: responsive headers, text scaling, balance card grids, form stacking, filter tab sizing, avatar layout.
- Zero logic changes.

### Mobile UX + Cleanup (Chunks 4-5)
- Login spacing, stacked delete confirmation, date input clickability (WebKit picker overlay).
- Filter pills → dropdown on mobile, balance card label shortening.
- Created `scripts/cleanup-test-data.ts` with dry-run mode. Cleaned: 32 payslips, 19 cancelled leaves, 5 cancelled expenses, 2 test employees.

### Leave Proration & Rollover
- Fixed `prorateLeave()` to use completed months only (join month excluded, MOM-aligned).
- Year-end rollover: CLI script (`year-end-rollover.ts`), API endpoint, admin Settings page button.
- AL carries forward (no cap), MC/CL/NPL reset yearly. Boss decision: no 3-month eligibility gate.
- Balance cards reordered, Q4 carry-over warning banner added.

### Half-Day Leave (AM/PM)
- New `DayType` enum (FULL_DAY, AM_HALF, PM_HALF) + `halfDayPosition` field on LeaveRequest.
- Overlap detection rewritten for AM/PM slot awareness.
- AL-only restriction: MC/CL/NPL forced to full-day (server-side enforcement).
- Calendar displays "(AM)"/"(PM)" indicators. 8 new unit tests (31/31 passing).

### Calendar Privacy & Balance Fixes
- Events fully private via `createdById` filter — admins cannot see other users' events.
- Calendar respects viewMode: admin "Show as Staff" sees only own leave.
- Dashboard balance fallback to `defaultDays` when no LeaveBalance record exists.
- Leave API auto-creates balance records for new year/employee edge cases.
- Filter layout restructured to two-row (search+dates / status pills), breakpoint lg→md.

### Workflow Automation
- Formalized post-execution pipeline in `.claude/commands/`: validate → code-review → commit.
- Local only (`.claude/` is gitignored).

## Key Findings
- Calendar had no viewMode awareness — admin toggle was ignored (data leak, fixed).
- SKIP_AUTH block in day detail didn't set userId — events query returned nothing (fixed).
- Dashboard showed 0 balance when no LeaveBalance record existed — needed defaultDays fallback.
- Prisma upsert with `update: {}` is a no-op — always include fields.
